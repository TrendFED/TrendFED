
(function($){$.fn.checkboxset=function(options){var defaults={tristate:true,data:{},change:function(name){}};var config=$.extend({},defaults,options,{$_selector:$(this)});this.checked=function(name){return config.$_selector.find("input[name='"+name+"']").attr("checked");}
this.indeterminate=function(name){return config.$_selector.find("input[name='"+name+"']").attr("indeterminate");}
__init__(config,config.data,"");return this;}
__init__=function(config,obj,prefix){for(var key in obj){var checked=false;var val=obj[key];if(isset(val.checked)){config.$_selector.find("input[name='"+key+"']").each(function(){$(this).attr("checked",val.checked);});delete val.checked;}
if(!empty(val)){__init__(config,val,empty(prefix)?key:prefix+"."+key);}
config.$_selector.find("input[name='"+key+"']").each(function(index){$(this).bind("click",{prefix:prefix,name:key,descendants:val},function(e){var checked=$(this).attr("checked");traverse_descendants(config,e.data.descendants,checked);traverse_ancestors(config,e.data.prefix);config.change(e.data.name,index);});});}
traverse_ancestors(config,prefix);}
traverse_descendants=function(config,objs,checked){for(var key in objs){var val=objs[key];if(!empty(val)){traverse_descendants(config,val,checked);}
config.$_selector.find("input[name='"+key+"']").each(function(){$(this).attr("checked",checked);});if(config.tristate){config.$_selector.find("input[name='"+key+"']").each(function(){$(this).attr("indeterminate",false);});}}}
traverse_ancestors=function(config,prefix){if(empty(prefix))
return;var arr=prefix.split(".");var obj=config.data;for(var i=0;i<arr.length;i++){obj=obj[arr[i]];if(!isset(obj))
break;}
var count=0,checked=0,indeterminate=0;for(var name in obj){config.$_selector.find("input[name='"+name+"']").each(function(){if($(this).attr("checked")){++checked;}
if($(this).attr("indeterminate")){++indeterminate;}
++count;});}
var name=arr.pop();config.$_selector.find("input[name='"+name+"']").each(function(){$(this).attr("checked",checked>0);});if(config.tristate){config.$_selector.find("input[name='"+name+"']").each(function(){$(this).attr("indeterminate",(checked>0&&count!=checked)||(indeterminate>0));});}
traverse_ancestors(config,arr.join("."));}
function isset(mixed_var){return(mixed_var!=null)&&(mixed_var!=undefined);}
function empty(mixed_var){if(mixed_var===""||mixed_var===0||mixed_var==="0"||mixed_var===null||mixed_var===false||typeof mixed_var==='undefined'){return true;}
if(!mixed_var){return true;}
if(typeof mixed_var=='object'){for(var key in mixed_var){return false;}
return true;}
return false;}})(jQuery);